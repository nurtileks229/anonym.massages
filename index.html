<!DOCTYPE html>
<html>
<head>
  <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .login-box { max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
    button { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
    button:hover { background: #45a049; }
    .message { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #4CAF50; }
    .delete-btn { background: #ff4444; color: white; }
    .anon-tag { background: #ff9800; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px; }
    .user-info { background: #e8f5e9; padding: 8px; margin: 5px 0; border-radius: 3px; font-size: 14px; }
  </style>
</head>
<body>

<div id="loginDiv">
  <div class="login-box">
    <h2>–ê–¥–º–∏–Ω –∫–∏—Ä–∏—à</h2>
    <p><strong>–ü–∞—Ä–æ–ª—å: nur123</strong></p>
    <input type="password" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å–¥—É –∂–∞–∑—ã“£—ã–∑">
    <button onclick="login()">–ö–ò–†“Æ“Æ</button>
  </div>
</div>

<div id="adminDiv" style="display:none;">
  <h1>üéØ –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò</h1>
  
  <div style="background:#4CAF50; color:white; padding:15px; border-radius:5px; margin-bottom:20px;">
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
    <p>–ë–∞—Ä–¥—ã–∫ –±–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä: <span id="messageCount">0</span></p>
    <p>–ê–Ω–æ–Ω–∏–º–¥“Ø“Ø: <span id="anonCount">0</span> | –ê–Ω–æ–Ω–∏–º —ç–º–µ—Å: <span id="publicCount">0</span></p>
  </div>
  
  <h2>üìù –ë–∞—Ä–¥—ã–∫ –±–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä</h2>
  <div id="messagesContainer"></div>
  
  <button onclick="logout()" style="background:#666; margin-top:20px;">–ß—ã–≥—É—É</button>
</div>

<script>
// Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const firebaseConfig = {
  apiKey: "AIzaSyARVtGnH1-xUk3fgKb_TmVfmqeFu706QSI",
  authDomain: "anonmasages.firebaseapp.com",
  projectId: "anonmasages",
  storageBucket: "anonmasages.firebasestorage.app",
  messagingSenderId: "916181623338",
  appId: "1:916181623338:web:ef1f98e61bd29b6ee25953"
};

// Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–ª–æ–æ
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ==== –ê–î–ú–ò–ù –õ–û–ì–ò–ù–ò ====
function login() {
  const password = document.getElementById('adminPassword').value;
  
  // –ê–î–ú–ò–ù –ü–ê–†–û–õ–¨
  const ADMIN_PASSWORD = "nur123";
  
  if (password === ADMIN_PASSWORD) {
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('adminDiv').style.display = 'block';
    loadMessages();
  } else {
    alert("‚ùå –ü–∞—Ä–æ–ª—å —Ç—É—É—Ä–∞ —ç–º–µ—Å!");
  }
}

// ==== –ë–ò–õ–î–ò–†“Æ“Æ–õ”®–†–î“Æ –ñ“Æ–ö–¢”®”® ====
function loadMessages() {
  db.collection('messages')
    .orderBy('timestamp', 'desc')
    .onSnapshot(snapshot => {
      document.getElementById('messageCount').textContent = snapshot.size;
      
      let anonCount = 0;
      let publicCount = 0;
      let html = '';
      
      snapshot.forEach(doc => {
        const data = doc.data();
        
        // –ê–Ω–æ–Ω–∏–º/–∞–Ω–æ–Ω–∏–º —ç–º–µ—Å —Å–∞–Ω–æ–æ—Å—É
        if (data.isAnonymous) {
          anonCount++;
        } else {
          publicCount++;
        }
        
        // –£–±–∞–∫—ã—Ç—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∞–ª–æ–æ
        let time = '–ñ–∞“£—ã —ç–ª–µ';
        if (data.timestamp?.toDate) {
          const date = data.timestamp.toDate();
          time = date.toLocaleDateString('ky-KG') + ' ' + 
                 date.getHours().toString().padStart(2, '0') + ':' + 
                 date.getMinutes().toString().padStart(2, '0');
        }
        
        // –ê–¥–º–∏–Ω “Ø—á“Ø–Ω —Ç–æ–ª—É–∫ –º–∞–∞–ª—ã–º–∞—Ç
        html += `
          <div class="message">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <strong>üë§ ${data.name}</strong>
              ${data.isAnonymous ? '<span class="anon-tag">–ê–ù–û–ù–ò–ú</span>' : '<span style="color:#4CAF50;">–ê–ù–û–ù–ò–ú –≠–ú–ï–°</span>'}
            </div>
            
            <p style="margin:10px 0;">${data.text}</p>
            
            <div class="user-info">
              <strong>–ß—ã–Ω—ã–≥—ã –∞—Ç—ã:</strong> ${data.realName || data.userInfo?.name || '–ë–µ–ª–≥–∏—Å–∏–∑'}<br>
              <strong>–ñ–∞—à—ã:</strong> ${data.userInfo?.age || '–ë–µ–ª–≥–∏—Å–∏–∑'}<br>
              <strong>–ñ–∞—à–∞–≥–∞–Ω –∂–µ—Ä–∏:</strong> ${data.userInfo?.location || '–ë–µ–ª–≥–∏—Å–∏–∑'}<br>
              <strong>–£–±–∞–∫—ã—Ç:</strong> ${time}<br>
              <strong>–ê–Ω–æ–Ω–∏–º –∫—ã–ª–¥—ã–±—ã?</strong> ${data.isAnonymous ? '–û–û–ë–ê' : '–ñ–û–ö'}
            </div>
            
            <button class="delete-btn" onclick="deleteMessage('${doc.id}')">üóëÔ∏è ”®—á“Ø—Ä“Ø“Ø</button>
          </div>
        `;
      });
      
      document.getElementById('anonCount').textContent = anonCount;
      document.getElementById('publicCount').textContent = publicCount;
      document.getElementById('messagesContainer').innerHTML = html;
      
    }, error => {
      console.error('–ö–∞—Ç–∞:', error);
      document.getElementById('messagesContainer').innerHTML = '<p>‚ùå –ë–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä–¥“Ø –∂“Ø–∫—Ç”©”© –º“Ø–º–∫“Ø–Ω —ç–º–µ—Å</p>';
    });
}

// ==== –ë–ò–õ–î–ò–†“Æ“Æ–ù“Æ ”®–ß“Æ–†“Æ“Æ ====
async function deleteMessage(id) {
  if (confirm('–ß—ã–Ω —ç–ª–µ ”©—á“Ø—Ä”©—Å“Ø–∑–±“Ø?')) {
    try {
      await db.collection('messages').doc(id).delete();
      alert('‚úÖ –ë–∏–ª–¥–∏—Ä“Ø“Ø ”©—á“Ø—Ä“Ø–ª–¥“Ø!');
    } catch (error) {
      alert('‚ùå –ö–∞—Ç–∞: ' + error.message);
    }
  }
}

// ==== –ê–î–ú–ò–ù–î–ï–ù –ß–´–ì–£–£ ====
function logout() {
  if (confirm('–ß—ã–≥—É—É–Ω—É –∫–∞–∞–ª–∞–π—Å—ã–∑–±—ã?')) {
    document.getElementById('adminDiv').style.display = 'none';
    document.getElementById('loginDiv').style.display = 'block';
    document.getElementById('adminPassword').value = '';
  }
}

console.log("üîê –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –¥–∞—è—Ä!");
</script>
</body>
</html>
