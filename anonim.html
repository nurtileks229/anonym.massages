<!DOCTYPE html>
<html lang="ky">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–π—ã–ª–¥—ã–∫ –ê–Ω–æ–Ω–∏–º</title>
  <!-- Firebase —Å–∫—Ä–∏–ø—Ç—Ç–µ—Ä–∏ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: #fff; }
    .page { display: none; min-height: 100vh; padding: 40px; }
    .active { display: block; }

    h1, h2 { text-align: center; }
    p { text-align: center; opacity: 0.9; }

    .center { max-width: 700px; margin: auto; }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      background: #ff4b2b;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
      margin: 5px;
    }
    button:hover { background: #ff6a4d; }

    .card {
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      margin: 15px 0;
    }

    textarea, input, select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      margin: 10px 0;
      font-size: 15px;
    }

    .message-header {
      font-weight: bold;
      margin-bottom: 8px;
      color: #ffd369;
    }

    .name-page {
      max-width: 500px;
      margin: 50px auto;
    }
  </style>
</head>
<body>

  <!-- 1-—Å–∞—Ö–∏—Ñ–µ: Welcome -->
  <div class="page active" id="welcome">
    <div class="center">
      <h1>–ö–æ—à –∫–µ–ª–∏“£–∏–∑ üëã</h1>
      <p>–ë—É–ª —Å–∞–π—Ç—Ç–∞ —Å–∏–∑ –¥–æ—Å—Ç–æ—Ä—É“£—É–∑ –º–µ–Ω–µ–Ω –∞—á—ã–∫ –∂–µ –∞–Ω–æ–Ω–∏–º –æ–π –±”©–ª“Ø—à”© –∞–ª–∞—Å—ã–∑.</p>
      <p><b>–ë—É–ª –∂–µ—Ä–¥–µ –±–∞–∞—Ä—ã –∫–æ–æ–ø—Å—É–∑ –¥–æ—Å—Ç–æ—Ä. –°”©–∑“Ø“£“Ø–∑ —Ç–∞–ª–∫—É—É–≥–∞ —Å–∞–ª—ã–Ω–±–∞–π—Ç</b></p>
      <div style="text-align:center; margin-top:40px;">
        <button onclick="goTo('name')">–ë–∞—à—Ç–æ–æ</button>
      </div>
    </div>
  </div>

  <!-- 2-—Å–∞—Ö–∏—Ñ–µ: –ê—Ç—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑ -->
  <div class="page" id="name">
    <div class="center name-page">
      <h2>”®–∑“Ø“£“Ø–∑–¥“Ø —Ç–∞–∞–Ω—ã—à—Ç—ã—Ä—ã“£—ã–∑</h2>
      <div class="card">
        <input type="text" id="userName" placeholder="–ê—Ç—ã“£—ã–∑" required>
        <input type="number" id="userAge" placeholder="–ñ–∞—à—ã“£—ã–∑" required>
        <input type="text" id="userLocation" placeholder="–ñ–∞—à–∞–≥–∞–Ω –∂–µ—Ä–∏“£–∏–∑" required>
        <div style="text-align:center; margin-top:20px;">
          <button onclick="saveUserInfo()">–ö–∏—Ä“Ø“Ø</button>
          <button onclick="goTo('welcome')" style="background:#2c5364;">–ê—Ä—Ç–∫–∞</button>

          <p>–≠—Å–∫–µ—Ä—Ç“Ø“Ø!</p>
          <p>–ê—Ç—ã–Ω—ã–∑–¥—ã –∂–∞–∑—ã–ø –∫–∏—Ä–∏—à–∏–Ω–∏–∑ —à–∞—Ä—Ç, —ç–≥–µ—Ä –∞–Ω–æ–Ω–∏–º—Å–∏–∑ –±–∏–ª–¥–∏—Ä“Ø“Ø –∂–∏–±–µ—Ä—Å–µ–Ω–∏–∑ –∞—Ç—ã–Ω—ã–∑ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã–∫ —Ç“Ø—Ä–¥–æ –∂–∞–∑—ã–ª–∞—Ç.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 3-—Å–∞—Ö–∏—Ñ–µ: –ù–µ–≥–∏–∑–≥–∏ —á–∞—Ç -->
  <div class="page" id="main">
    <div class="center">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2>–ë–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä</h2>
        <div>
          <span id="currentUserName"></span>
          <button onclick="goTo('name')" style="background:#2c5364;">–ê—Ç—ã–Ω ”©–∑–≥”©—Ä—Ç“Ø“Ø</button>
        </div>
      </div>
      
      <div id="messages"></div>



     <div class="card">
        <h3>–ñ–∞“£—ã –±–∏–ª–¥–∏—Ä“Ø“Ø –∂–∞–∑—É—É</h3>
        <select id="mode">
          <option value="anon">–ê–Ω–æ–Ω–∏–º–Ω—ã–π</option>
          <option value="name">–ù–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–π</option>
        </select>
        <input type="text" id="name" placeholder="–ê—Ç—ã“£—ã–∑" style="display:none;" />
        <textarea id="text" placeholder="–û—é“£—É–∑–¥—É –∂–∞–∑—ã“£—ã–∑..."></textarea>
        <button onclick="addMessage()">–ñ–∞—Ä—ã—è–ª–æ–æ</button>
      </div>

<script>
  // ==== FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø–°–´ ====
  const firebaseConfig = {
    apiKey: "AIzaSyARVtGnH1-xUk3fgKb_TmVfmqeFu706QSI",
    authDomain: "anonmasages.firebaseapp.com",
    projectId: "anonmasages",
    storageBucket: "anonmasages.firebasestorage.app",
    messagingSenderId: "916181623338",
    appId: "1:916181623338:web:ef1f98e61bd29b6ee25953",
    measurementId: "G-QC7KF9T4XB"
  };

  // ==== FIREBASE –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ==== –ö–û–õ–î–û–ù–£–£–ß–£ –ú–ê–ê–õ–´–ú–ê–¢–¢–ê–†–´ ====
  let currentUser = {
    name: '',
    age: '',
    location: ''
  };

  // ==== –°–ê–•–ò–§–ï–õ–ï–†–î–ò ”®–ó–ì”®–†–¢“Æ“Æ ====
  function goTo(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(page).classList.add('active');
    
    if (page === 'main') {
      loadMessages();
      document.getElementById('currentUserName').textContent = currentUser.name;
    }
  }

  // ==== –ö–û–õ–î–û–ù–£–£–ß–£ –ú–ê–ê–õ–´–ú–ê–¢–´–ù –°–ê–ö–¢–û–û ====
  function saveUserInfo() {
    const name = document.getElementById('userName').value.trim();
    const age = document.getElementById('userAge').value;
    const location = document.getElementById('userLocation').value.trim();
    
    if (!name || !age || !location) {
      alert('–ë–∞—Ä–¥—ã–∫ —Ç–∞–ª–∞–∞–ª–∞—Ä–¥—ã —Ç–æ–ª—Ç—É—Ä—É“£—É–∑!');
      return;
    }
    
    currentUser = { name, age, location };
    
    // LocalStorage'–≥–∞ —Å–∞–∫—Ç–æ–æ (–±—Ä–∞—É–∑–µ—Ä –∂–∞–±—ã–ª—Å–∞ –¥–∞ —Å–∞–∫—Ç–∞–ª–∞—Ç)
    localStorage.setItem('chatUser', JSON.stringify(currentUser));
    
    goTo('main');
  }

  // ==== –ë–†–ê–£–ó–ï–† –ñ–ê–ë–´–õ–ì–ê–ù–î–ê –î–ê –°–ê–ö–¢–ê–õ–°–´–ù ====
  window.onload = function() {
    const savedUser = localStorage.getItem('chatUser');
    if (savedUser) {
      currentUser = JSON.parse(savedUser);
      goTo('main');
    }
  };

  // ==== –ë–ò–õ–î–ò–†“Æ“Æ –ö–û–®–£–£ ====
  async function addMessage() {
    if (!currentUser.name) {
      alert('–ê–ª–≥–∞—á –∞—Ç—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑!');
      goTo('name');
      return;
    }
    
    const mode = document.getElementById('mode').value;
    const text = document.getElementById('text').value;
    
    if (!text.trim()) {
      alert('–ë–æ—à –±–∏–ª–¥–∏—Ä“Ø“Ø –±–æ–ª–±–æ–π—Ç');
      return;
    }

    try {
      // –ê–Ω–æ–Ω–∏–º –∂–µ –∞–Ω–æ–Ω–∏–º —ç–º–µ—Å —ç–∫–µ–Ω–∏–Ω —Ç–µ–∫—à–µ—Ä“Ø“Ø
      const isAnonymous = mode === 'anon';
      
      // Firebase'–∫–µ —Å–∞–∫—Ç–æ–æ
      await db.collection('messages').add({
        name: isAnonymous ? '–ê–Ω–æ–Ω–∏–º' : currentUser.name,
        text: text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        userInfo: {
          name: currentUser.name,
          age: currentUser.age,
          location: currentUser.location
        },
        isAnonymous: isAnonymous,
        realName: currentUser.name // –ê–¥–º–∏–Ω “Ø—á“Ø–Ω —á—ã–Ω—ã–≥—ã –∞—Ç—ã
      });

      document.getElementById('text').value = '';
      alert('–ë–∏–ª–¥–∏—Ä“Ø“Ø –∏–π–≥–∏–ª–∏–∫—Ç“Ø“Ø –∂”©–Ω”©—Ç“Ø–ª–¥“Ø!');
      
    } catch (error) {
      console.error('–ö–∞—Ç–∞:', error);
      alert('–ë–∏–ª–¥–∏—Ä“Ø“Ø –∂”©–Ω”©—Ç“Ø“Ø –º“Ø–º–∫“Ø–Ω —ç–º–µ—Å. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—Ç–∏ —Ç–µ–∫—à–µ—Ä–∏“£–∏–∑.');
    }
  }

  // ==== –ë–ò–õ–î–ò–†“Æ“Æ–õ”®–†–î“Æ –ñ“Æ–ö–¢”®”® ====
  function loadMessages() {
    // –†–µ–∞–ª–¥—É—É —É–±–∞–∫—ã—Ç—Ç–∞ –∫”©–∑”©–º”©–ª–¥”©”©
    db.collection('messages')
      .orderBy('timestamp', 'desc')
      .onSnapshot(snapshot => {
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML = '';
        
        if (snapshot.empty) {
          messagesDiv.innerHTML = '<div class="card">–ë–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä –∂–æ–∫. –ë–∏—Ä–∏–Ω—á–∏ –±–æ–ª—É–ø –∂–∞–∑—ã“£—ã–∑!</div>';
          return;
        }

        snapshot.forEach(doc => {
          const data = doc.data();
          const card = document.createElement('div');
          card.className = 'card';
          
          // –£–±–∞–∫—ã—Ç—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∞–ª–æ–æ
          const time = data.timestamp?.toDate 
            ? new Date(data.timestamp.toDate()).toLocaleString('ky-KG')
            : '–ñ–∞“£—ã —ç–ª–µ';
          
          // –ñ”©–Ω”©–∫”©–π –∫–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä–≥–∞ –∫”©—Ä—Å”©—Ç“Ø“Ø
          card.innerHTML = `
            <div class="message-header">${data.name}</div>
            <div>${data.text}</div>
            <small style="opacity:0.7; display:block; margin-top:10px;">${time}</small>
          `;
          messagesDiv.appendChild(card);
        });
      }, error => {
        console.error('–ë–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä–¥“Ø –∂“Ø–∫—Ç”©”©–¥”© –∫–∞—Ç–∞:', error);
        messagesDiv.innerHTML = '<div class="card">–ë–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä–¥“Ø –∂“Ø–∫—Ç”©”© –º“Ø–º–∫“Ø–Ω —ç–º–µ—Å.</div>';
      });
  }

  // ==== –°–ê–ô–¢ –ê–ß–´–õ–ì–ê–ù–î–ê ====
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–ª–∞–Ω–¥—ã');
  });
</script>
</body>
</html>